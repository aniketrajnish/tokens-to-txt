<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>tokens‚Äëto‚Äëtxt</title>
  <meta name="description" content="Decode OpenAI token IDs to text. Minimal, fast, and supports multiple encodings." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Coming+Soon&display=swap" rel="stylesheet">
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <style>
    :root {
      --accent: #635994;
      --bg: #ffffff;
      --fg: #141217;
      --muted: #6e6a86;
      --panel: #ffffff;
      --border: #e7e3ff;
      --shadow: 0 1px 0 rgba(20,18,23,0.03), 0 8px 24px rgba(99,89,148,0.06);
      --maxw: 980px;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0f0e13;
        --fg: #eceaf7;
        --muted: #b5b1d6;
        --panel: #151320;
        --border: #28233c;
        --shadow: 0 1px 0 rgba(0,0,0,0.25), 0 8px 24px rgba(0,0,0,0.35);
      }
    }
    * { box-sizing: border-box; }
    html, body { background: var(--bg); color: var(--fg); }
    body {
      font-family: "Coming Soon", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      font-size: 16px; line-height: 1.5; margin: 24px; -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
    }
    button, input, select, textarea { font: inherit; }
    main { max-width: var(--maxw); margin: 0; }
    h1 { font-size: 28px; margin: 0; letter-spacing: -0.01em; }
    a { color: inherit; text-decoration: none; }
    a.gh { display:flex; align-items:center; gap:8px; }
    a.gh:hover { text-decoration: underline; }
    a.gh span { text-transform: lowercase; }

    .topbar { display:flex; justify-content: space-between; align-items:center; margin-bottom:16px; }

    .grid { display: grid; grid-template-columns: minmax(0,1fr) 340px; gap: 24px; align-items: start; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

    label { font-weight: 700; display:block; margin-bottom: 6px; }
    textarea {
      width: 100%;
      min-height: 160px;
      border: 2px solid var(--fg);
      border-radius: 10px;
      padding: 12px 14px;
      background: var(--panel);
      color: var(--fg);
      resize: none;
      overflow-y: hidden;
    }

    .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 12px; box-shadow: var(--shadow); }
    .enc-list { display: grid; gap: 10px; }
    .enc {
      display:flex; flex-direction:column; align-items:flex-start; gap:3px;
      border:1px solid var(--border); border-radius:12px;
      background: color-mix(in oklab, var(--panel) 90%, var(--accent));
      padding: 10px 12px; cursor: pointer; transition: transform .02s ease;
      color: var(--fg);
    }
    .enc * { color: inherit; }
    .enc small { color: var(--muted); }
    .enc:active { transform: translateY(1px); }
    .enc.active { background: var(--accent); color: #fff; border-color: var(--accent); }
    .enc.active small { color: #f3ecff; opacity: .9; }

    pre { border:1px dashed var(--border); border-radius: 10px; padding:12px; background: var(--panel); color: var(--fg); white-space: pre-wrap; word-wrap: break-word; margin: 6px 0 0; }

    footer { margin-top: 14px; color: var(--muted); font-size: 14px; }
    .emoji { font-family: system-ui, "Apple Color Emoji", "Segoe UI Emoji"; }
  </style>
</head>
<body>
  <main>
    <header class="topbar">
      <h1>tokens‚Äëto‚Äëtxt <span class="emoji" title="spider">üï∑Ô∏è</span></h1>
      <a class="gh" href="https://github.com/aniketrajnish/tokens-to-txt" target="_blank" rel="noopener" title="View source on GitHub">
        <svg width="22" height="22" viewBox="0 0 16 16" aria-hidden="true" focusable="false" role="img"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8Z"/></svg>
        <span>github</span>
      </a>
    </header>

    <div class="grid">
      <section>
        <label for="ids">token ids</label>
        <textarea id="ids" placeholder="format- [13203, 614]  or  13203,614  or  13203 614"></textarea>
        <div style="margin-top:10px">
          <label>txt</label>
          <pre id="out">‚Äî</pre>
        </div>
        <footer>its all part of the bigger plan <span class="emoji">üòâ</span></footer>
      </section>

      <aside class="panel">
        <div class="muted" style="margin-bottom:8px">encoding</div>
        <div class="enc-list" id="enc-buttons"></div>
      </aside>
    </div>
  </main>

  <script defer>
    const ENCODING_SCRIPTS = {
      o200k_base: 'https://unpkg.com/gpt-tokenizer@2.9.0/dist/o200k_base.js',
      cl100k_base: 'https://unpkg.com/gpt-tokenizer@2.9.0/dist/cl100k_base.js',
      p50k_base: 'https://unpkg.com/gpt-tokenizer@2.9.0/dist/p50k_base.js',
    };

    const GLOBALS = {
      o200k_base: 'GPTTokenizer_o200k_base',
      cl100k_base: 'GPTTokenizer_cl100k_base',
      p50k_base: 'GPTTokenizer_p50k_base',
    };

    const ENCODING_META = {
      o200k_base: 'gpt‚Äë4o / 4.1 / o‚Äëseries',
      cl100k_base: 'gpt‚Äë4 / 3.5 / emb‚Äëv3',
      p50k_base: 'text‚Äëdavinci‚Äë003 / codex',
    };

    const idsEl = document.getElementById('ids');
    const outEl = document.getElementById('out');
    const encButtonsEl = document.getElementById('enc-buttons');

    let currentEnc = 'o200k_base';

    function makeButton(enc) {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'enc' + (enc === currentEnc ? ' active' : '');
      btn.dataset.enc = enc;
      btn.innerHTML = `<strong>${enc}</strong><small>${ENCODING_META[enc]||''}</small>`;
      btn.addEventListener('click', async () => {
        currentEnc = enc;
        for (const b of encButtonsEl.querySelectorAll('.enc')) b.classList.remove('active');
        btn.classList.add('active');
        await ensureLoaded(enc);
        decodeNow();
      });
      return btn;
    }

    function createButtons() {
      Object.keys(ENCODING_SCRIPTS).forEach(enc => encButtonsEl.appendChild(makeButton(enc)));
    }

    function parseIds(raw) {
      if (!raw || !raw.trim()) return [];
      raw = raw.trim();
      if (raw.startsWith('[')) { try { return JSON.parse(raw).map(Number).filter(Number.isFinite); } catch (_) {} }
      return raw.split(/[\s,]+/).map(Number).filter(Number.isFinite);
    }

    function getGlobal(enc) { return window[GLOBALS[enc]]; }

    function loadScript(src) { return new Promise((resolve, reject) => {
      const s = document.createElement('script');
      s.src = src; s.async = true; s.onload = resolve; s.onerror = reject; document.head.appendChild(s);
    }); }

    async function ensureLoaded(enc) {
      if (getGlobal(enc)) return true;
      const src = ENCODING_SCRIPTS[enc];
      try { await loadScript(src); return !!getGlobal(enc); }
      catch { return false; }
    }

    async function decodeNow() {
      const ids = parseIds(idsEl.value);
      if (!ids.length) { outEl.textContent = '‚Äî'; return; }
      const ok = await ensureLoaded(currentEnc);
      if (!ok) return;
      try { outEl.textContent = getGlobal(currentEnc).decode(ids); }
      catch (e) { outEl.textContent = `error: ${e?.message || e}`; }
    }
    
    function autoResizeTextarea() {
      idsEl.style.height = 'auto';
      idsEl.style.height = idsEl.scrollHeight + 'px';
    }

    idsEl.addEventListener('input', () => {
      decodeNow();
      autoResizeTextarea();
    });

    createButtons();
    ensureLoaded(currentEnc).then(decodeNow);
  </script>
</body>
</html>
